---
description: 
globs: 
alwaysApply: false
---
## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- **í”„ë¡œì íŠ¸**: Sometimes - ëŒ€ì „ 11ê°œ ëŒ€í•™ìƒ ì‹ ë¢° ê¸°ë°˜ AI ì†Œê°œíŒ… í”Œë«í¼
- **ì‘ì„±ì¼**: 2025ë…„ 5ì›” 23ì¼
- **ë²„ì „**: v1.0
- **ë‹´ë‹¹ì**: ê°œë°œíŒ€

---
## ğŸ¯ ê°œìš”
### í˜„ì¬ ìƒí™©
Sometimes í”Œë«í¼ì˜ AI ë§¤ì¹­ ì‹œìŠ¤í…œì—ì„œÂ **íŠ¹ì • ì‚¬ìš©ìë“¤ì—ê²Œ ë§¤ì¹­ì´ í¸í–¥ë˜ëŠ” ë¬¸ì œ**ê°€ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì‚¬ìš©ì ê²½í—˜ ì €í•˜ì™€ í”Œë«í¼ ì‹ ë¢°ë„ ê°ì†Œë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆëŠ” ì¤‘ìš”í•œ ì´ìŠˆì…ë‹ˆë‹¤.

### ê°œì„  ëª©í‘œ
- ë§¤ì¹­ ë‹¤ì–‘ì„± ì¦ì§„ (í¸í–¥ì„± í•´ì†Œ)
- ìœ ì‚¬ë„ ì ìˆ˜ ê¸°ë°˜ í’ˆì§ˆ í–¥ìƒ
- ì‚¬ìš©ì ë§Œì¡±ë„ ê°œì„ 

---

## ğŸ” í˜„ì¬ ì‹œìŠ¤í…œ ë¶„ì„
### ë§¤ì¹­ í”„ë¡œì„¸ìŠ¤

```
1. ì‚¬ìš©ì í”„ë¡œí•„ â†’ í…ìŠ¤íŠ¸ ë³€í™˜ â†’ OpenAI ì„ë² ë”© ìƒì„±
2. Qdrant ë²¡í„° ê²€ìƒ‰ìœ¼ë¡œ ìœ ì‚¬í•œ ì‚¬ìš©ì 10-30ëª… í›„ë³´ ì¶”ì¶œ
3. Redis ë§¤ì¹­ ì´ë ¥ í™•ì¸í•˜ì—¬ ì´ì „ ë§¤ì¹­ ì‚¬ìš©ì ì œì™¸
4. ë‚¨ì€ í›„ë³´ ì¤‘ ì™„ì „ ëœë¤ ì„ íƒ (choiceRandom)
5. ë§¤ì¹­ ìƒì„± ë° ì•Œë¦¼ ë°œì†¡
```

### ê¸°ìˆ  ìŠ¤íƒ
- **ì„ë² ë”©**: OpenAI text-embedding-3-small
- **ë²¡í„° DB**: Qdrant
- **ìºì‹œ**: Redis (ë§¤ì¹­ ì´ë ¥ ê´€ë¦¬)
- **ë°±ì—”ë“œ**: NestJS + TypeScript

---

## ğŸš¨ ë¬¸ì œì  ë¶„ì„
### 1. íŒŒíŠ¸ë„ˆ ì„ íƒ ì•Œê³ ë¦¬ì¦˜ì˜ í•œê³„

```typescript
// í˜„ì¬ êµ¬í˜„
private getOnePartner(partners: Similarity[]) {
  return choiceRandom(partners); // ì™„ì „ ëœë¤ ì„ íƒ
}
```

**ë¬¸ì œì :**
- ìœ ì‚¬ë„ ì ìˆ˜ ë¬´ì‹œ: ë²¡í„° ê²€ìƒ‰ìœ¼ë¡œ ê³„ì‚°ëœ ìœ ì‚¬ë„ë¥¼ í™œìš©í•˜ì§€ ì•ŠìŒ
- ë§¤ì¹­ ì´ë ¥ ë¯¸ê³ ë ¤: ê°œë³„ ì‚¬ìš©ìì˜ ë§¤ì¹­ ë¹ˆë„ë‚˜ ìµœê·¼ ë§¤ì¹­ ì´ë ¥ ë¬´ì‹œ
- ë‹¤ì–‘ì„± ë¶€ì¡±: í•­ìƒ ìƒìœ„ê¶Œì— ìˆëŠ” ì‚¬ìš©ìë“¤ë§Œ ë§¤ì¹­ë  ê°€ëŠ¥ì„±
### 2. ì„ë² ë”© ìƒì„± ë°©ì‹ì˜ í•œê³„
```
í˜„ì¬: "ë‚˜ì´: 24ì„¸ ì„±ë³„: MALE MBTI: ISFP ìŒì£¼ ì„ í˜¸ë„: ìƒê´€ì—†ìŒ ê´€ì‹¬ì‚¬: ì‚¬ì§„, ìì „ê±°, ë°˜ë ¤ë™ë¬¼..."
```

**ë¬¸ì œì :**
- ì†ì„±ë³„ ê°€ì¤‘ì¹˜ ë¶€ì¡±: ëª¨ë“  ì†ì„±ì´ ë™ì¼í•œ ì˜í–¥ë ¥
- ì˜ë¯¸ì  êµ¬ì¡° ì†ì‹¤: ì¤‘ìš”í•œ ì†ì„±ê³¼ ë¶€ì°¨ì  ì†ì„± êµ¬ë¶„ ë¶ˆê°€
- í…ìŠ¤íŠ¸ ìˆœì„œ ì˜ì¡´ì„±: ì•ìª½ í…ìŠ¤íŠ¸ì— ë” í° ì˜í–¥ë ¥
### 3. ë§¤ì¹­ ë‹¤ì–‘ì„± ê´€ë¦¬ ë¶€ì¡±
- ë§¤ì¹­ íšŸìˆ˜ ì¶”ì  ì‹œìŠ¤í…œ ë¶€ì¬
- ë§¤ì¹­ ë¹ˆë„ ê· ë“±í™” ë©”ì»¤ë‹ˆì¦˜ ì—†ìŒ
- ì‚¬ìš©ìë³„ ë§¤ì¹­ ì„±ê³µë¥  ë°ì´í„° ë¶€ì¡±
---
## ğŸ’¡ ê°œì„  ë°©ì•ˆ
### Phase 1: íŒŒíŠ¸ë„ˆ ì„ íƒ ì•Œê³ ë¦¬ì¦˜ ê°œì„  (ì¦‰ì‹œ ì ìš©)
#### 1.1 ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì„ íƒ ì‹œìŠ¤í…œ
```typescript
// ê°œì„ ëœ íŒŒíŠ¸ë„ˆ ì„ íƒ ë¡œì§
private async getOnePartner(partners: Similarity[], userId: string) {
  const weightedPartners = await this.calculatePartnerWeights(partners, userId);
  return this.selectPartnerByWeight(weightedPartners);
}

private async calculatePartnerWeights(partners: Similarity[], userId: string) {
  const weights = await Promise.all(partners.map(async (partner) => {
    // 1. ìœ ì‚¬ë„ ì ìˆ˜ ì •ê·œí™” (0.4 ê°€ì¤‘ì¹˜)
    const similarityScore = partner.similarity * 0.4;
    
    // 2. ë§¤ì¹­ ë‹¤ì–‘ì„± ì ìˆ˜ (0.6 ê°€ì¤‘ì¹˜)
    const diversityScore = await this.calculateDiversityScore(partner.userId) * 0.6;
    
    return {
      ...partner,
      finalWeight: similarityScore + diversityScore
    };
  }));
  
  return weights;
}
```

#### 1.2 ë§¤ì¹­ ë‹¤ì–‘ì„± ì ìˆ˜ ê³„ì‚°

```typescript
private async calculateDiversityScore(userId: string): Promise<number> {
  // ë§¤ì¹­ íšŸìˆ˜ ì¡°íšŒ (ë‚®ì„ìˆ˜ë¡ ë†’ì€ ì ìˆ˜)
  const matchCount = await this.cacheManager.get(`user:${userId}:match_count`) || 0;
  const countScore = Math.max(0, 1 - (matchCount * 0.1));
  
  // ìµœê·¼ ë§¤ì¹­ ì‹œê°„ í™•ì¸ (ì˜¤ë˜ë ìˆ˜ë¡ ë†’ì€ ì ìˆ˜)
  const lastMatch = await this.cacheManager.get(`user:${userId}:last_match`);
  const timeScore = this.calculateTimeScore(lastMatch);
  
  return (countScore * 0.7) + (timeScore * 0.3);
}
```

#### 1.3 ë§¤ì¹­ í†µê³„ ì¶”ì  ì‹œìŠ¤í…œ

```typescript
// ë§¤ì¹­ ìƒì„± ì‹œ í†µê³„ ì—…ë°ì´íŠ¸
private async updateMatchingStats(userId: string, partnerId: string) {
  const currentTime = new Date().toISOString();
  
  // ë§¤ì¹­ íšŸìˆ˜ ì¦ê°€
  const currentCount = await this.cacheManager.get(`user:${partnerId}:match_count`) || 0;
  await this.cacheManager.set(`user:${partnerId}:match_count`, currentCount + 1, 30 * 24 * 60 * 60); // 30ì¼
  
  // ìµœê·¼ ë§¤ì¹­ ì‹œê°„ ì—…ë°ì´íŠ¸
  await this.cacheManager.set(`user:${partnerId}:last_match`, currentTime, 30 * 24 * 60 * 60);
}
```

### Phase 2: ì„ë² ë”© í’ˆì§ˆ ê°œì„  (ì¤‘ê¸°)
#### 2.1 êµ¬ì¡°í™”ëœ í…ìŠ¤íŠ¸ í¬ë§·

```typescript
private formatProfileTextWithWeights(profile: UserProfile): string {
  const interests = this.extractInterests(profile);
  const personality = this.extractPersonality(profile);
  
  return `
í•µì‹¬ ê´€ì‹¬ì‚¬: ${interests}
ì£¼ìš” ì„±ê²© ë° ì—°ì• ìŠ¤íƒ€ì¼: ${personality}
ì¤‘ìš” ê´€ì‹¬ì‚¬ ì¬ê°•ì¡°: ${interests}
MBTI ì„±í–¥: ${profile.mbti}
ë‚˜ì´ ë° ì„±ë³„: ${profile.age}ì„¸ ${profile.gender}
ìƒí™œ ì„ í˜¸ë„: ${this.extractLifestyle(profile)}
ê´€ì‹¬ì‚¬ ìµœì¢… ê°•ì¡°: ${interests}
  `.trim();
}
```
#### 2.2 ë‹¤ì¤‘ ë²¡í„° ì„ë² ë”© ì‹œìŠ¤í…œ

```typescript
// ê° ì†ì„±ë³„ ë³„ë„ ì„ë² ë”© ìƒì„±
async createWeightedEmbedding(profile: UserProfile): Promise<number[]> {
  const embeddings = {
    interests: await this.createEmbedding(this.extractInterests(profile)),
    personality: await this.createEmbedding(this.extractPersonality(profile)),
    lifestyle: await this.createEmbedding(this.extractLifestyle(profile)),
    demographics: await this.createEmbedding(this.extractDemographics(profile))
  };
  
  // ì†ì„±ë³„ ê°€ì¤‘ì¹˜ ì ìš©
  const weights = { interests: 0.35, personality: 0.30, lifestyle: 0.20, demographics: 0.15 };
  return this.calculateWeightedSum(embeddings, weights);
}
```

### Phase 3: ê³ ê¸‰ ë§¤ì¹­ ì‹œìŠ¤í…œ (ì¥ê¸°)

#### 3.1 ë§¤ì¹­ ì„±ê³µë¥  í”¼ë“œë°± ì‹œìŠ¤í…œ
- ì‚¬ìš©ì í”¼ë“œë°± ê¸°ë°˜ ë§¤ì¹­ í’ˆì§ˆ í‰ê°€
- ë§¤ì¹­ í›„ ìƒí˜¸ì‘ìš© ë°ì´í„° ìˆ˜ì§‘
- í•™ìŠµ ê¸°ë°˜ ê°€ì¤‘ì¹˜ ìë™ ì¡°ì •

#### 3.2 A/B í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬
- ë‹¤ì–‘í•œ ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ ë™ì‹œ í…ŒìŠ¤íŠ¸
- ì‹¤ì‹œê°„ ì„±ëŠ¥ ë¹„êµ ë° ìµœì í™”

---

## ğŸ“… êµ¬í˜„ ì¼ì •
í’€íƒ€ì„ ê·¼ë¬´ë¡œ ì´ì •ë„ ê±¸ë¦°ë‹¤ ì°¸ê³ ë§Œ
### Week 1: Phase 1 êµ¬í˜„
- **Day 1-2**: ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì„ íƒ ë¡œì§ êµ¬í˜„
- **Day 3-4**: ë§¤ì¹­ í†µê³„ ì¶”ì  ì‹œìŠ¤í…œ êµ¬ì¶•
- **Day 5-7**: í…ŒìŠ¤íŠ¸ ë° ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
### Week 2-3: Phase 2 êµ¬í˜„
- **Week 2**: êµ¬ì¡°í™”ëœ í…ìŠ¤íŠ¸ í¬ë§· ì ìš©
- **Week 3**: ë‹¤ì¤‘ ë²¡í„° ì„ë² ë”© ì‹œìŠ¤í…œ ê°œë°œ
### Week 4-8: Phase 3 ì—°êµ¬ ë° ê°œë°œ
- ë§¤ì¹­ ì„±ê³µë¥  í”¼ë“œë°± ì‹œìŠ¤í…œ ì„¤ê³„
- A/B í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ êµ¬ì¶•
---
### ì •ëŸ‰ì  íš¨ê³¼
- **ë§¤ì¹­ ë‹¤ì–‘ì„± ì§€ìˆ˜ 30% í–¥ìƒ**: íŠ¹ì • ì‚¬ìš©ì ë§¤ì¹­ í¸ì¤‘ ê°ì†Œ
- **ìœ ì‚¬ë„ í™œìš©ë¥  100% ì¦ê°€**: ëœë¤ ì„ íƒ â†’ ì ìˆ˜ ê¸°ë°˜ ì„ íƒ
- **ë§¤ì¹­ ë§Œì¡±ë„ 20% í–¥ìƒ**: ë” ì í•©í•œ íŒŒíŠ¸ë„ˆ ë§¤ì¹­
### ì •ì„±ì  íš¨ê³¼
- ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
- í”Œë«í¼ ì‹ ë¢°ë„ ì¦ê°€
- ë§¤ì¹­ í’ˆì§ˆì˜ ì¼ê´€ì„± í™•ë³´
---
## âš ï¸ ë¦¬ìŠ¤í¬ ë° ëŒ€ì‘ë°©ì•ˆ
### ê¸°ìˆ ì  ë¦¬ìŠ¤í¬
**ë¦¬ìŠ¤í¬**: ìƒˆë¡œìš´ ì•Œê³ ë¦¬ì¦˜ì˜ ì„±ëŠ¥ ì €í•˜  
**ëŒ€ì‘**: ë‹¨ê³„ì  ì ìš© ë° A/B í…ŒìŠ¤íŠ¸ë¥¼ í†µí•œ ê²€ì¦

**ë¦¬ìŠ¤í¬**: Redis ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€  
**ëŒ€ì‘**: TTL ì„¤ì • ë° ë°ì´í„° ì •ë¦¬ ë°°ì¹˜ ì‘ì—…
### ë¹„ì¦ˆë‹ˆìŠ¤ ë¦¬ìŠ¤í¬
**ë¦¬ìŠ¤í¬**: ê¸°ì¡´ ì‚¬ìš©ì ë§¤ì¹­ íŒ¨í„´ ë³€í™”  
**ëŒ€ì‘**: ì ì§„ì  ì ìš© ë° ì‚¬ìš©ì í”¼ë“œë°± ëª¨ë‹ˆí„°ë§

**ë¦¬ìŠ¤í¬**: ë§¤ì¹­ ì‹œê°„ ì§€ì—°  
**ëŒ€ì‘**: ì„±ëŠ¥ ìµœì í™” ë° ìºì‹± ì „ëµ ì ìš©

---
## ğŸ“ ê²°ë¡ 

í˜„ì¬ ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ì˜ í¸í–¥ì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ 3ë‹¨ê³„ ê°œì„  ê³„íšì„ ìˆ˜ë¦½í–ˆìŠµë‹ˆë‹¤. Phase 1ì˜ ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì„ íƒ ì‹œìŠ¤í…œì„ ìš°ì„  êµ¬í˜„í•˜ì—¬ ì¦‰ì‹œ íš¨ê³¼ë¥¼ í™•ì¸í•˜ê³ , ë‹¨ê³„ì ìœ¼ë¡œ ì„ë² ë”© í’ˆì§ˆê³¼ ê³ ê¸‰ ë§¤ì¹­ ì‹œìŠ¤í…œì„ ê°œì„ í•´ ë‚˜ê°ˆ ì˜ˆì •ì…ë‹ˆë‹¤.

ì´ëŸ¬í•œ ê°œì„ ì„ í†µí•´ ì‚¬ìš©ìë“¤ì—ê²Œ ë” ê³µì •í•˜ê³  í’ˆì§ˆ ë†’ì€ ë§¤ì¹­ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•  ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ê¸°ëŒ€ë©ë‹ˆë‹¤.
